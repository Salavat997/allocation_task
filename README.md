**Аллокация добычи по пластам**

Исходные данные - excel файл well\_data.xlsx.

На первом листе rates представлены данные добычи продукции по скважинам (well\_id) за интервал в 10 суток. Нефть – oil\_rate, вода – water\_rate, газ – gas\_rate.

На втором листе splits – доля добычи тех же скважин (well\_id) по пластам (layer\_id), выраженная в процентах. Нефть – oil\_split, вода – water\_split, газ – gas\_split. Значения этих коэффициентов (сплитов) могут изменяться ото дня ко дню, набор пластов для скважины также может изменяться.

Третий лист invalid\_splits – копия второго с ошибками в заполнении данных.


1. **Задача валидации данных**

Сумма сплитов по одной скважине на одну дату по конкретному типу флюида (нефть, вода, газ) должна быть равна 100% для заданных пластов.

![](001.png)

Необходимо по данным третьего листа invalid\_splits определить и записать список скважин, соответствующие даты и тип флюида, где сумма сплитов не равняется 100%.




1. **Расчёт аллокации**

Для каждого пласта в каждой строчке таблицы сплитов (2 лист splits) посчитать соответствующий расход каждого флюида (нефть, вода, газ) по формуле

split\_rate = rate \* split / 100

Значения расходов (rate) брать из таблицы на 1 листе rates по well\_id и dt

Решение на примере одной скважины:

1. Берём сплиты для скважины 1 на первое декабря 

![](002.png)

1. Берём расходы для скважины 1 на первое декабря

![](003.png)

1. Перемножаем значения. Получаем следующие записи

![](004.png)


3. **Сохранение результатов**

Результаты второй задачи сохранить в виде excel файла, а также в json файл следующего формата. Названия полей в camelCase, даты со временем в ISO формате.

{

`    `"allocation": {

`        `"data": [

`            `{

`                `"wellId": 0,

`                `"dt": "2022-12-01T00:00:00",

`                `"layerId": 4,

`                `"oilRate": 15.29527178593368,

`                `"gasRate": 80.93229959419733,

`                `"waterRate": 47.76733547397225

`            `},

`            `{

`                `"wellId": 1,

`                `"dt": "2022-12-01T00:00:00",

`                `"layerId": 0,

`                `"oilRate": 0.9428405445540975,

`                `"gasRate": 50.21562630167292,

`                `"waterRate": 31.57716155334533

`            `},

`            `...

`        `]

`    `}

}



